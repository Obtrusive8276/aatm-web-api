<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AATM - Amazing Automatic Torrent Maker</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath d='M25 15 L25 55 Q25 75 45 75 L45 85 Q15 85 15 55 L15 15 Z' fill='%231a1a4e'/%3E%3Cpath d='M75 15 L75 55 Q75 75 55 75 L55 85 Q85 85 85 55 L85 15 Z' fill='%231a1a4e'/%3E%3Crect x='15' y='10' width='15' height='15' rx='2' fill='%23c0c0c0'/%3E%3Crect x='70' y='10' width='15' height='15' rx='2' fill='%23c0c0c0'/%3E%3Cellipse cx='50' cy='50' rx='8' ry='12' fill='%2300d9ff' opacity='0.6'/%3E%3C/svg%3E">
    <link rel="stylesheet" href="static/css/styles.css">
</head>
<body>
    <div class="app-container">
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1>AATM</h1>
                <p class="subtitle">Torrent Maker</p>
            </div>
            <div class="nav-menu">
                <div class="nav-item active" data-page="files">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
                    <span>Explorateur</span>
                </div>
                <div class="nav-item" data-page="create">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
                    <span>Creer Torrent</span>
                </div>
                <div class="nav-item" data-page="settings">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                    <span>Parametres</span>
                </div>
                <div class="nav-item" data-page="history">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                    <span>Historique</span>
                </div>
            </div>
            <div class="api-status">
                <span class="status-indicator online" id="statusIndicator"></span>
                <span id="statusText">API en ligne</span>
            </div>
        </nav>

        <main class="main-content">
            <header class="header">
                <h2 id="pageTitle">Explorateur de fichiers</h2>
                <div id="headerActions"></div>
            </header>

            <div class="content-area">
                <!-- Files Page -->
                <div id="page-files" class="page">
                    <div class="explorer-container">
                        <div class="file-browser">
                            <div style="display:flex;align-items:center;gap:1rem;margin: 0.5rem 1rem;">
                                <div class="breadcrumb" id="breadcrumb" style="flex:1;margin-bottom:0;"><span class="breadcrumb-item current">/</span></div>
                                <button class="btn btn-primary btn-sm" id="btnCreateFromFolder" title="Creer un torrent de ce dossier">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/><line x1="12" y1="11" x2="12" y2="17"/><line x1="9" y1="14" x2="15" y2="14"/></svg>
                                    Torrent du dossier
                                </button>
                            </div>
                            <div class="search-box" style="margin: 0.5rem 1rem;">
                                <input type="text" class="form-control" id="fileSearchInput" placeholder="Rechercher un fichier..." style="width:100%;">
                            </div>
                            <div class="file-list" id="fileList"><div class="loading"><div class="spinner"></div>Chargement...</div></div>
                        </div>
                        <div class="details-panel">
                            <div class="details-header"><h3 id="detailsTitle">Details</h3></div>
                            <div class="details-content" id="detailsContent">
                                <div class="empty-state">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                                    <p>Selectionnez un fichier pour voir ses details</p>
                                </div>
                            </div>
                            <div class="action-buttons" id="fileActions" style="display:none;">
                                <button class="btn btn-primary btn-full" id="btnStartWorkflow">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
                                    Creer un torrent
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Create Workflow Page -->
                <div id="page-create" class="page hidden">
                    <div class="workflow-container">
                        <div class="workflow-steps">
                            <div class="workflow-step active" data-step="1"><div class="step-number">1</div><div class="step-label">Type</div></div>
                            <div class="workflow-step" data-step="2"><div class="step-number">2</div><div class="step-label">TMDB</div></div>
                            <div class="workflow-step" data-step="3"><div class="step-number">3</div><div class="step-label">NFO</div></div>
                            <div class="workflow-step" data-step="4"><div class="step-number">4</div><div class="step-label">Validation</div></div>
                            <div class="workflow-step" data-step="5"><div class="step-number">5</div><div class="step-label">Creation</div></div>
                            <div class="workflow-step" data-step="6"><div class="step-number">6</div><div class="step-label">Upload</div></div>
                        </div>

                        <!-- Step 1: Type Selection -->
                        <div class="workflow-content" id="step-1">
                            <h3 class="workflow-title">Selection du type de media</h3>
                            <div id="selectedSource"></div>
                            <div class="media-type-selector" id="mediaTypeSelector">
                                <div class="media-type-btn" data-type="movie">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/><line x1="7" y1="2" x2="7" y2="22"/><line x1="17" y1="2" x2="17" y2="22"/><line x1="2" y1="12" x2="22" y2="12"/><line x1="2" y1="7" x2="7" y2="7"/><line x1="2" y1="17" x2="7" y2="17"/><line x1="17" y1="17" x2="22" y2="17"/><line x1="17" y1="7" x2="22" y2="7"/></svg>
                                    <span>Film</span>
                                </div>
                                <div class="media-type-btn" data-type="episode">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="15" rx="2" ry="2"/><polyline points="17 2 12 7 7 2"/></svg>
                                    <span>Episode</span>
                                </div>
                                <div class="media-type-btn" data-type="season">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/><line x1="12" y1="11" x2="12" y2="17"/><line x1="9" y1="14" x2="15" y2="14"/></svg>
                                    <span>Saison</span>
                                </div>
                                <div class="media-type-btn" data-type="ebook">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
                                    <span>E-book</span>
                                </div>
                                <div class="media-type-btn" data-type="game">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="6" width="20" height="12" rx="2"/><line x1="6" y1="12" x2="10" y2="12"/><line x1="8" y1="10" x2="8" y2="14"/><circle cx="17" cy="10" r="1"/><circle cx="15" cy="13" r="1"/></svg>
                                    <span>Jeu video</span>
                                </div>
                            </div>
                            <div class="detail-section" style="margin-top:1rem;">
                                <h4>Tags detectes</h4>
                                <div class="release-tags" id="releaseTags">-</div>
                            </div>
                            <div class="workflow-actions">
                                <button class="btn btn-secondary" onclick="navigateTo('files')">Choisir un fichier</button>
                                <button class="btn btn-primary" id="btnStep1Next" disabled>Suivant</button>
                            </div>
                        </div>

                        <!-- Step 2: Metadata Search (TMDB / Google Books / Steam) -->
                        <div class="workflow-content hidden" id="step-2">
                            <h3 class="workflow-title" id="step2Title">Identification</h3>
                            <div class="form-group">
                                <label id="step2Label">Rechercher</label>
                                <div class="search-row">
                                    <input type="text" class="form-control" id="metadataQuery" placeholder="Rechercher...">
                                    <button class="btn btn-primary" id="btnMetadataSearch">Rechercher</button>
                                </div>
                                <div id="metadataResults" class="tmdb-results hidden"></div>
                                <div id="metadataSelected" class="hidden"></div>
                            </div>
                            <div class="workflow-actions">
                                <button class="btn btn-secondary" onclick="goToStep(1)">Precedent</button>
                                <button class="btn btn-primary" id="btnStep2Next" disabled>Suivant</button>
                            </div>
                        </div>

                        <!-- Step 3: NFO -->
                        <div class="workflow-content hidden" id="step-3">
                            <h3 class="workflow-title">MediaInfo et NFO</h3>
                            <div class="form-group">
                                <label>Apercu MediaInfo</label>
                                <div class="mediainfo-output" id="workflowMediainfo">Chargement...</div>
                            </div>
                            <div class="form-group">
                                <label>Contenu NFO (editable)</label>
                                <textarea class="form-control" id="nfoContent" placeholder="Le contenu MediaInfo sera copie ici..."></textarea>
                            </div>
                            <div class="workflow-actions">
                                <button class="btn btn-secondary" onclick="goToStep(2)">Precedent</button>
                                <button class="btn btn-primary" onclick="goToStep(4)">Suivant</button>
                            </div>
                        </div>

                        <!-- Step 4: Validation -->
                        <div class="workflow-content hidden" id="step-4">
                            <h3 class="workflow-title">Validation finale</h3>
                            
                            <!-- Row 1: Release name (full width) -->
                            <div class="detail-section" style="margin-bottom: 1rem;">
                                <h4>Nom du release</h4>
                                <div class="form-control" id="validationReleaseName" style="background: var(--bg-tertiary); cursor: not-allowed; font-size: 0.85rem; word-break: break-all;"></div>
                            </div>

                            <!-- Row 2: Two columns - Metadata + MediaInfo -->
                            <div style="display: grid; grid-template-columns: 1fr 1.5fr; gap: 1.5rem; margin-bottom: 1.5rem; align-items: stretch;">
                                <!-- Column 1: Metadata -->
                                <div class="detail-section" style="display: flex; flex-direction: column;">
                                    <h4>Métadonnées</h4>
                                    <div class="validation-metadata" id="validationMetadata" style="flex: 1; overflow-y: auto; max-height: 280px;"></div>
                                </div>

                                <!-- Column 2: MediaInfo -->
                                <div class="detail-section" style="display: flex; flex-direction: column;">
                                    <h4>MediaInfo</h4>
                                    <pre id="validationMediaInfo" style="background: var(--bg-tertiary); padding: 0.75rem; border-radius: 6px; font-size: 0.7rem; flex: 1; max-height: 280px; overflow-y: auto; white-space: pre-wrap; margin: 0;"></pre>
                                </div>
                            </div>

                            <!-- Row 3: Presentation (full width) -->
                            <div class="detail-section" style="margin-bottom: 1.5rem;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <h4 style="margin: 0;">Présentation La Cale</h4>
                                    <button class="btn btn-sm" id="btnTogglePresentationView" onclick="togglePresentationView()" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">Voir BBCode</button>
                                </div>
                                <div id="presentationContainer">
                                    <div id="presentationPreview" class="presentation-preview"></div>
                                    <textarea id="presentationEditor" class="form-control hidden" style="min-height: 200px; font-family: monospace; font-size: 0.8rem;"></textarea>
                                </div>
                            </div>

                            <!-- Row 4: Tags (full width, horizontal) -->
                            <div class="detail-section" style="margin-bottom: 1.5rem;">
                                <h4>Tags La Cale <small style="color: var(--text-muted); font-weight: normal;">(cliquez pour modifier)</small></h4>
                                <div id="validationTagsContainer" class="tags-selector-horizontal"></div>
                            </div>

                            <div class="workflow-actions">
                                <button class="btn btn-secondary" onclick="goToStep(3)">Précédent</button>
                                <button class="btn btn-primary" id="btnValidationConfirm">Confirmer et créer</button>
                            </div>
                        </div>

                        <!-- Step 5: Torrent Creation -->
                        <div class="workflow-content hidden" id="step-5">
                            <h3 class="workflow-title">Création du torrent</h3>
                            <div id="creationProgress" class="hidden"><div class="loading"><div class="spinner"></div>Creation en cours...</div></div>
                            <div id="creationResult" class="hidden"></div>
                            <div class="workflow-actions">
                                <button class="btn btn-secondary" onclick="goToStep(4)" id="btnStep5Back">Precedent</button>
                            </div>
                        </div>

                        <!-- Step 6: Upload -->
                        <div class="workflow-content hidden" id="step-6">
                            <h3 class="workflow-title">Upload</h3>
                            <div class="detail-section">
                                <h4>Fichiers créés</h4>
                                <div class="detail-row"><span class="detail-label">Torrent</span><span class="detail-value" id="createdTorrentPath">-</span></div>
                                <div class="detail-row"><span class="detail-label">NFO</span><span class="detail-value" id="createdNfoPath">-</span></div>
                            </div>
                            <div id="uploadStatus" style="margin-top: 1rem;"></div>
                            <div class="workflow-actions">
                                <button class="btn btn-secondary" onclick="goToStep(4)">Retour</button>
                                <button class="btn btn-success" id="btnFinish">Terminer et uploader sur La Cale</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Page -->
                <div id="page-settings" class="page hidden">
                    <div class="settings-container">
                        <div class="settings-section">
                            <h3>Chemins</h3>
                            <div class="form-group">
                                <label>Chemin racine des medias</label>
                                <input type="text" class="form-control" id="settingRootPath" placeholder="/media">
                            </div>
                        </div>
                        <div class="settings-section">
                            <h3>Trackers par defaut</h3>
                            <div class="form-group">
                                <label>Liste des trackers (un par ligne)</label>
                                <textarea class="form-control" id="settingTrackers" rows="4"></textarea>
                            </div>
                        </div>
                        <div class="settings-section">
                            <h3>Client Torrent</h3>
                            <div class="form-group">
                                <label>Client pour l'ajout des torrents</label>
                                <select class="form-control" id="settingTorrentClient" onchange="toggleTorrentClientSettings()">
                                    <option value="qbittorrent">qBittorrent</option>
                                    <option value="transmission">Transmission</option>
                                    <option value="deluge">Deluge</option>
                                    <option value="none">Aucun (ne pas ajouter)</option>
                                </select>
                            </div>
                            <!-- qBittorrent Settings -->
                            <div id="qbittorrentSettings" class="client-settings">
                                <h4 style="margin-top:15px;color:var(--text-muted);">qBittorrent</h4>
                                <div class="form-group"><label>URL</label><input type="text" class="form-control" id="settingQbitUrl" placeholder="http://localhost:8080"></div>
                                <div class="form-group"><label>Nom d'utilisateur</label><input type="text" class="form-control" id="settingQbitUsername" placeholder="admin"></div>
                                <div class="form-group"><label>Mot de passe</label><input type="password" class="form-control" id="settingQbitPassword"></div>
                            </div>
                            <!-- Transmission Settings -->
                            <div id="transmissionSettings" class="client-settings" style="display:none;">
                                <h4 style="margin-top:15px;color:var(--text-muted);">Transmission</h4>
                                <div class="form-group"><label>URL</label><input type="text" class="form-control" id="settingTransmissionUrl" placeholder="http://localhost:9091"></div>
                                <div class="form-group"><label>Nom d'utilisateur</label><input type="text" class="form-control" id="settingTransmissionUsername"></div>
                                <div class="form-group"><label>Mot de passe</label><input type="password" class="form-control" id="settingTransmissionPassword"></div>
                            </div>
                            <!-- Deluge Settings -->
                            <div id="delugeSettings" class="client-settings" style="display:none;">
                                <h4 style="margin-top:15px;color:var(--text-muted);">Deluge</h4>
                                <div class="form-group"><label>URL</label><input type="text" class="form-control" id="settingDelugeUrl" placeholder="http://localhost:8112"></div>
                                <div class="form-group"><label>Mot de passe</label><input type="password" class="form-control" id="settingDelugePassword" placeholder="deluge"></div>
                            </div>
                        </div>
                        <div class="settings-section">
                            <h3>La-Cale</h3>
                            <div class="form-group"><label>Email</label><input type="email" class="form-control" id="settingLaCaleEmail"></div>
                            <div class="form-group"><label>Mot de passe</label><input type="password" class="form-control" id="settingLaCalePassword"></div>
                            <div class="form-group"><label>Passkey</label><input type="text" class="form-control" id="settingLaCalePasskey"></div>
                        </div>
                        <div class="settings-section">
                            <h3>Hardlinks</h3>
                            <div class="form-group">
                                <div class="form-check">
                                    <input type="checkbox" id="settingEnableHardlink">
                                    <label for="settingEnableHardlink">Activer la creation de hardlinks</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Repertoires de destination (un par ligne, un par disque)</label>
                                <textarea class="form-control" id="settingHardlinkDirs" rows="3" placeholder="/mnt/disk1/torrents&#10;/mnt/disk2/torrents"></textarea>
                                <small style="color:var(--text-muted);">Le repertoire sur le meme disque que la source sera automatiquement selectionne</small>
                            </div>
                        </div>
                        <div class="settings-section">
                            <h3>Affichage</h3>
                            <div class="form-group">
                                <div class="form-check">
                                    <input type="checkbox" id="settingShowProcessed">
                                    <label for="settingShowProcessed">Afficher les fichiers deja traites</label>
                                </div>
                            </div>
                        </div>
                        <button class="btn btn-primary btn-full" id="btnSaveSettings">Sauvegarder les parametres</button>
                    </div>
                </div>

                <!-- History Page -->
                <div id="page-history" class="page hidden">
                    <div class="history-container">
                        <div class="history-header">
                            <h3>Fichiers traites</h3>
                            <button class="btn btn-danger" id="btnClearHistory">Effacer l'historique</button>
                        </div>
                        <div class="history-list" id="historyList"><div class="loading"><div class="spinner"></div>Chargement...</div></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="toast-container" id="toastContainer"></div>

    <!-- Modules JavaScript (ordre important) -->
    <script src="static/js/config.js"></script>
    <script src="static/js/state.js"></script>
    <script src="static/js/utils.js"></script>
    <script src="static/js/parsers.js"></script>
    <script src="static/js/generators.js"></script>
    <script src="static/js/models/Media.js"></script>
    <script src="static/js/models/Film.js"></script>
    <script src="static/js/models/Serie.js"></script>
    <script src="static/js/models/MediaFactory.js"></script>
    <script src="static/js/api.js"></script>
    <script src="static/js/presentation.js"></script>
    <script src="static/js/app.js"></script>
</body>
</html>
